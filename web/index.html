<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Copper Portal Test</title>

  <link rel="stylesheet" href="jquery-ui.css">
  <link rel="stylesheet" href="style.css">
  <script src="lib/jquery-1.12.4.min.js"></script>
  <script src="lib/jquery-ui.min.js"></script>
  <script src="data_manager.js"></script>
  <script src="widgets.js"></script>


  <script>

var dataManager = new DataManager();

$( function() {
    var testData=
{"widgets":[
{"id":"w0","x":20,"y":100,"width":170,"height":70,"title":"Siti","body":""},
{"id":"w1","x":420,"y":400,"width":140,"height":80,"title":"SB","body":""},
{"id":"w2","x":780,"y":300,"width":148,"height":68,"title":"IN","body":""},
{"id":"w3","x":20,"y":200,"width":172,"height":72,"title":"RCPers","body":""},
{"id":"w4","x":20,"y":300,"width":174,"height":74,"title":"Ref-INF","body":""},
{"id":"w5","x":600,"y":400,"width":144,"height":84,"title":"TE","body":""},
{"id":"w6","x":780,"y":400,"width":144,"height":84,"title":"IN","body":""},
{"id":"w7","x":960,"y":400,"width":144,"height":84,"title":"VA","body":""},
{"id":"w8","x":20,"y":400,"width":176,"height":76,"title":"RCEnt","body":""},
{"id":"w9","x":1140,"y":400,"width":144,"height":84,"title":"PP","body":""},
{"id":"w10","x":1320,"y":400,"width":140,"height":80,"title":"PR","body":""},
{"id":"w11","x":960,"y":300,"width":150,"height":70,"title":"VA","body":""},
{"id":"w12","x":1140,"y":300,"width":150,"height":70,"title":"PP","body":""},
{"id":"w13","x":1320,"y":300,"width":130,"height":70,"title":"PR","body":""},
{"id":"w15","x":1500,"y":680,"width":368,"height":48,"title":"TIME","body":"#CSS_CLASS_time##TIME#<span id='date'>#DATE#</span>"},
{"id":"w16","x":1500,"y":240,"width":374,"height":154,"title":"Météo","body":""},
{"id":"w16","x":1500,"y":420,"width":370,"height":230,"title":"Webcam","body":""},
{"id":"w17","x":1500,"y":760,"width":374,"height":254,"title":"Menu","body":""},
{"id":"w18","x":1500,"y":60,"width":376,"height":156,"title":"Bureau","body":"Some body\nand a new line..."},
{"id":"w19","x":220,"y":400,"width":158,"height":78,"title":"Builds","body":""},
{"id":"w20","x":600,"y":300,"width":148,"height":68,"title":"DC","body":""}
]};

    dataManager.import(testData);


// Shortcuts
$(document).keypress(function( event ) {
    if ( event.key == 'e' ) {
        event.preventDefault();
        dataManager.toggleEditable();
    }
});




// Upload file by simulating a click on <input type='file'> and capturing file
uploadFile = function(callback) {
    document.getElementById('upload').addEventListener('change', 
        function() {
            var file = this.files[0];
            console.log("Reading " + file.name + " size " + file.size);
            var reader = new FileReader();
            reader.onload = ( function(e) { callback(e.target.result); } );
            //reader.readAsDataURL(file);
            reader.readAsText(file, "UTF-8");
        }, false);
    $("#upload").click();
}


// Download file by creating a dummy link and clicking on it
downloadFile = function(mime, encoding, body, filename) {
    var data = 'data:' + mime + ';charset=' + encoding + ',' + encodeURIComponent(body);
    $("#download").attr({
      'download': filename
      ,'href': data
      ,'target' : '_blank'
    });
    $("#download").get(0).click();
}



} );


setInterval(function() {
    dataManager.handleMessage("refresh");
}, 5000);


  </script>
</head>
<body>

<!-- =============================[ TOOLBOX ]============================== -->
<div id='toolbox' class='toolbox' style='top: 20px; left: 20px;'>
  <div class='toolbox_title'>Tools</div>
  <button onclick="dataManager.addWidget(80, 20);">New</span>
  <button onclick="dataManager.clear()">Clear</span>
  <button onclick="dataManager.export()">Export</span>
  <button onclick="dataManager.import()">Import</span>
  <button onclick="dataManager.toggleEditable()">Exit edition</span>
</div>

<div id="data">
</div>

<div id="pi" style="position:absolute; right: 5px; bottom: 5px">
    <a style='color: silver;cursor:pointer' onclick="dataManager.toggleEditable()">&pi;</a>
</div>

<div style="visibility:hidden">
    <a id="download"></a>
    <input id="upload" name="file" type="file">
</div>
     
</body>
</html>
